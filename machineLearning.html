<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ml5.js</title>
</head>
<body>
    <input type="file" id="flora" class="flora" webkitdirectory directory mutiple>Flora<br>    
    <input type="file" id="yuna" class="yuna" webkitdirectory directory mutiple>Yuna<br>    
    <input type="file" id="joy" class="joy" webkitdirectory directory mutiple>Joy<br>    
    <input type="button" value="Train" id="train"><br>
    <input type="button" value="Save" id="save"><br>
    <input type="file" id="resource">Select an image<br>    

    <!-- Load ml5.js from a script tag -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script>
        const floraFiles = document.querySelector("#flora");
        const yunaFiles = document.querySelector("#yuna");
        const joyFiles = document.querySelector("#joy");
        const trainBtn = document.querySelector("#train");
        const saveBtn = document.querySelector("#save");
        const resourceFile = document.querySelector("#resource");

        function modelReady(){
            console.log("model is ready!!");

            classifier.load("model.json", customModelReady);            
        }

        function customModelReady(){
            console.log("custom model is ready!!", );
        }

        function handleFiles(){
            const labelName = this.className;
            for(let i = 0; i < this.files.length; i++){
                let file = this.files[i];
                let temp = new Image();
                temp.className = labelName;
                temp.onload = () => {
                    temp.width = temp.naturalWidth;
                    temp.height = temp.naturalHeight;
                    classifier.addImage(temp, labelName);
                };
                temp.src = "./training-data/" + labelName + "/" + file.name;
            }
        }

        let mobilenet = ml5.featureExtractor("MobileNet", modelReady);
        
        let classifier = mobilenet.classification();

        floraFiles.addEventListener("change", handleFiles);
        yunaFiles.addEventListener("change", handleFiles);
        joyFiles.addEventListener("change", handleFiles);

        trainBtn.addEventListener("click", e => {
            e.preventDefault();
            classifier.train((loss) => {
                console.log(loss);
            });
        });

        saveBtn.addEventListener("click", e => {
            e.preventDefault();
            classifier.save();
        });

        resourceFile.addEventListener("change", e => {
            let img = new Image();
            img.onload = () => {
                img.width = img.naturalWidth;
                img.height = img.naturalHeight;
                classifier.classify(img, (error, result) => {
                    if(error){
                        console.log(error);
                    }else{
                        console.log(result);
                    }
                });
                img.src = "./" + e.target.files[0].name;
            };
        });
    </script>
</body>
</html>