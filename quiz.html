<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>CODER.K49</title>
        <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />
    </head>
    <body>
        <div id="quizApp">
            <!-- banner -->
            <div id="informational-banner" tabindex="-1" class="fixed top-0 start-0 z-50 flex flex-col justify-between w-full p-4 border-b border-gray-200 md:flex-row bg-orange-50 ">
                <div class="mb-4 md:mb-0 md:me-4">
                    <h2 class="mb-1 text-base font-semibold text-gray-900 ">數學題</h2>
                    <p class="flex items-center text-sm font-normal text-gray-500 ">共有 {{ quizs.length }} 道題目</p>
                </div>
                <div class="flex items-center">
                    <a href="#" @click="setQuiz" class="inline-flex items-center justify-center px-3 py-2 me-3 text-xs font-medium text-gray-900 bg-red-300 border border-gray-200 rounded-lg hover:text-gray-900 hover:bg-gray-100 hover:ring-2 hover:ring-black focus:outline-none focus:z-10 focus:ring-4 focus:ring-gray-100 ">
                        <svg class="w-3 h-3 mr-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13v-2a1 1 0 0 0-1-1h-.757l-.707-1.707.535-.536a1 1 0 0 0 0-1.414l-1.414-1.414a1 1 0 0 0-1.414 0l-.536.535L14 4.757V4a1 1 0 0 0-1-1h-2a1 1 0 0 0-1 1v.757l-1.707.707-.536-.535a1 1 0 0 0-1.414 0L4.929 6.343a1 1 0 0 0 0 1.414l.536.536L4.757 10H4a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h.757l.707 1.707-.535.536a1 1 0 0 0 0 1.414l1.414 1.414a1 1 0 0 0 1.414 0l.536-.535 1.707.707V20a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-.757l1.707-.708.536.536a1 1 0 0 0 1.414 0l1.414-1.414a1 1 0 0 0 0-1.414l-.535-.536.707-1.707H20a1 1 0 0 0 1-1Z"/>
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/>
                        </svg>
                        設定題型
                    </a>
                    <a href="#" @click="generateQuiz" class="inline-flex items-center justify-center px-3 py-2 me-3 text-xs font-medium text-gray-900 bg-orange-300 border border-gray-200 rounded-lg hover:text-gray-900 hover:bg-gray-100 hover:ring-2 hover:ring-black focus:outline-none focus:z-10 focus:ring-4 focus:ring-gray-100 ">
                        <svg class="w-3 h-3 mr-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 18">
                            <path d="M9 1.334C7.06.594 1.646-.84.293.653a1.158 1.158 0 0 0-.293.77v13.973c0 .193.046.383.134.55.088.167.214.306.366.403a.932.932 0 0 0 .5.147c.176 0 .348-.05.5-.147 1.059-.32 6.265.851 7.5 1.65V1.334ZM19.707.653C18.353-.84 12.94.593 11 1.333V18c1.234-.799 6.436-1.968 7.5-1.65a.931.931 0 0 0 .5.147.931.931 0 0 0 .5-.148c.152-.096.279-.235.366-.403.088-.167.134-.357.134-.55V1.423a1.158 1.158 0 0 0-.293-.77Z"/>
                        </svg> 
                        產生題目
                    </a>
                    <a href="#" v-if="showCheck" @click="checkAns" class="inline-flex items-center justify-center px-3 py-2 me-2 text-xs font-medium text-gray-900 bg-yellow-300 rounded-lg hover:text-gray-900 hover:bg-gray-100 hover:ring-2 hover:ring-black focus:ring-4 focus:ring-blue-300 focus:outline-none ">
                        <svg class="w-3 h-3 mr-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m8.032 12 1.984 1.984 4.96-4.96m4.55 5.272.893-.893a1.984 1.984 0 0 0 0-2.806l-.893-.893a1.984 1.984 0 0 1-.581-1.403V7.04a1.984 1.984 0 0 0-1.984-1.984h-1.262a1.983 1.983 0 0 1-1.403-.581l-.893-.893a1.984 1.984 0 0 0-2.806 0l-.893.893a1.984 1.984 0 0 1-1.403.581H7.04A1.984 1.984 0 0 0 5.055 7.04v1.262c0 .527-.209 1.031-.581 1.403l-.893.893a1.984 1.984 0 0 0 0 2.806l.893.893c.372.372.581.876.581 1.403v1.262a1.984 1.984 0 0 0 1.984 1.984h1.262c.527 0 1.031.209 1.403.581l.893.893a1.984 1.984 0 0 0 2.806 0l.893-.893a1.985 1.985 0 0 1 1.403-.581h1.262a1.984 1.984 0 0 0 1.984-1.984V15.7c0-.527.209-1.031.581-1.403Z"/>
                        </svg>
                        總計
                    </a>
                    <span v-if="showCheck" class="pl-8">
                        {{ checkRst }}
                    </span>
                </div>
            </div>
            
            <!-- 設定題型 -->
            <div v-if="appState=='SET'" class="w-full md:mt-[100px] sm:mt-[140px] mt-[150px] justify-items-center">
                <div class="p-4 space-y-4">
                    <div class="w-full">
                        <label for="quizCount">題目數量: </label>
                        <input name="quizCount" type="number" :value="quizCount" class="w-30 ml-2" @change="setQuizCount" />
                    </div>
                    <div class="w-full">
                        <label for="quizMaxNum">題目中可能的最大數字: </label>
                        <input name="quizMaxNum" type="number" :value="quizMaxNum" class="w-30 ml-2" @change="setQuizMaxNum" />
                    </div>
                </div>
            </div>

            <!-- 題目清單 -->
            <div v-if="appState=='QUIZ'" class="w-full md:mt-[100px] sm:mt-[140px] mt-[150px] justify-items-center">
                <div v-for="(quizObj, index) in quizs" 
                    :id="quizObj.quizId"
                    class="w-3/4 sm:w-1/2 p-6 bg-gray-100 border border-gray-900 rounded-lg shadow-lg">
                    <h5 class="mb-2 text-2xl font-bold tracking-tight text-gray-900">Q{{ index + 1 }}.</h5>
                    <div class="inline-flex items-center">
                        <span class="mb-3 font-normal text-gray-700 dark:text-gray-400">{{ quizObj.quiz }}</span>

                        <input type="number" :id="quizObj.inputAnsId" @change="changeAns" :disabled="quizObj.answered" required placeholder="0"
                            class="bg-gray-50 border text-gray-900 text-sm rounded-lg focus:ring-yellow-500 focus:border-yellow-500 w-30 p-2.5 mr-5 " 
                            :class="{ 'border-red-500': !quizObj.result && quizObj.answered, 'border-blue-500': quizObj.result && quizObj.answered, 'border-gray-300': !quizObj.answered }" />                        

                        <svg v-if="quizObj.answered && quizObj.result" class="w-6 h-6 text-blue-900" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 11.917 9.724 16.5 19 7.5"/>
                        </svg>

                        <svg v-if="quizObj.answered && !quizObj.result" class="w-6 h-6 text-red-900" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 17.94 6M18 18 6.06 6"/>
                        </svg>
                    </div>

                    <span class="hidden">
                        {{ quizObj.real_answer }}
                        {{ quizObj.user_answer }}
                        {{ quizObj.result }}
                        {{ quizObj.answered }}
                    </span>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
        <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>

        <script type="importmap">
        {
            "imports": {
                "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.prod.js"
            }
        }
        </script>
        <script type="module">
            import { createApp, ref, reactive } from 'vue'

            createApp({
                setup() {
                    const appState = ref("QUIZ")
                    const quizCount = ref(10)
                    const quizMaxNum = ref(10)
                    const showCheck = ref(true)
                    const checkRst = ref("")
                    const quizs = reactive([])

                    // 設定題型
                    function setQuiz(event){
                        //console.log("setQuiz", event);
                        appState.value = "SET";
                    }
                    // 設定題目數量
                    function setQuizCount(event){
                        quizCount.value = event.target.value;
                    }
                    // 設定產生題目時最大可能出現的數字
                    function setQuizMaxNum(event){
                        quizMaxNum.value = event.target.value;
                    }
                    // 產生 quiz 清單
                    function generateQuiz(event){
                        appState.value = "QUIZ";

                        // 清空 quizs
                        quizs.splice(0, quizs.length);
                        
                        for(let q_i = 0; q_i < quizCount.value; q_i++){
                            let q_left = Math.floor(Math.random() * quizMaxNum.value) + 1;
                            let q_right = Math.floor(Math.random() * quizMaxNum.value) + 1;

                            let quizObj = {
                                quiz: q_left + " + " + q_right + " = ",
                                real_answer: q_left + q_right,
                                user_answer: 0,
                                result: false,
                                answered: false,
                                quizId: "quiz_" + q_i,
                                inputAnsId: "ans_" + q_i,
                                nextQuizId: "next_" + q_i,
                            };
                            quizs.push( quizObj );
                        }

                        checkRst.value = "";
                    }
                    // answer input 改變時, 同步改變 quizs 中的 user_answer
                    function changeAns(event){
                        //console.log("changeAns", event, event.target.id, event.target.value);

                        let targetEleId = event.target.id;
                        let targetValue = event.target.value;

                        let quizIndex = parseInt( targetEleId.split("_")[1] );
                        quizs[quizIndex].answered = true;
                        quizs[quizIndex].user_answer = parseInt( targetValue );
                        quizs[quizIndex].result = parseInt(quizs[quizIndex].user_answer) === parseInt(quizs[quizIndex].real_answer);
                    }
                    // 驗證答案
                    function checkAns(event){
                        let correctCount = 0;
                        let wrongCount = 0;
                        let noneCount = 0;

                        quizs.forEach((quizObj, index) => {
                            if(quizObj.answered){
                                if(quizObj.result){
                                    correctCount += 1;
                                }else{
                                    wrongCount += 1;
                                }
                            }else{
                                noneCount += 1;
                            }
                        });


                        checkRst.value = "正確: " + correctCount + " / 錯誤: " + wrongCount + " / 未答: " + noneCount;
                    }

                    return {
                        appState,
                        quizCount,
                        quizMaxNum,
                        showCheck,
                        checkRst,
                        quizs,

                        setQuiz,
                        setQuizCount,
                        setQuizMaxNum,
                        generateQuiz,
                        changeAns,
                        checkAns,
                    }
                }
            }).mount('#quizApp')
        </script>
    </body>
</html>